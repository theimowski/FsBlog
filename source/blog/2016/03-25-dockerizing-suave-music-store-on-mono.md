@{
    Layout = "post";
    Title = "Dockerizing Suave Music Store on mono";
    Date = "2016-03-26T11:06:56";
    Tags = "Suave.IO,F#,Docker,Mono,Linux,Postgres,Paket";
    Description = "";
}

I've written the [Suave Music Store GitBook](https://theimowski.gitbooks.io/suave-music-store), which helped quite a few people to get started with the [Suave.IO](https://suave.io/) library for creating web applications in F#.
However the original version of tutorial didn't really feel x-platform, as it was designed to work on Windows only. 
I decided to revisit the tutorial and add 3 more sections describing how to convert the app to run on [mono](http://www.mono-project.com/) and place inside a [Docker](https://www.docker.com/) container. 

<!--more-->

## Steps required

I've decided to split the desired goal into 3 parts:

1. Converting form NuGet restore client to Paket
2. Changing the database from SQL Server to Postgres
3. Setting up docker containers

If you don't care much about details, and just want to check out the final code - follow [this](https://github.com/theimowski/SuaveMusicStore/tree/docker) link. 

## Moving to paket

First step was to move away from the NuGet client, as it can bring some pain in conjunction with mono.
Also Paket has a number of advantages comparing to the NuGet client - you can read about them [here](https://fsprojects.github.io/Paket/faq.html).
Because of that, before trying to compile the application on my ubuntu box and mono, I made use of the [`paket convert-from-nuget`](https://fsprojects.github.io/Paket/paket-convert-from-nuget.html) command.

[GitBook - Moving to paket section](https://theimowski.gitbooks.io/suave-music-store/content/en/moving_to_paket.html)

## Using postgres

Next step was to switch the database vendor from Microsoft SQL Server, which as the name might suggest can **[currently](https://blogs.microsoft.com/blog/2016/03/07/announcing-sql-server-on-linux/)** be run on Windows box only, to a more cross-platform [Postgres](http://www.postgresql.org/).
This required quite an effort, specially since I decided not to abandon the [SQLProvider](http://fsprojects.github.io/SQLProvider/) F# Type Provider I used to access SQL Server, which does support Postgres, but had subtle issues with uppercase tables / column names.
Because of that I eventually made all names lowercase, and that resulted in necessity to adjust respective class properties generated by the type provider.  

[GitBook - Using postgres section](https://theimowski.gitbooks.io/suave-music-store/content/en/using_postgres.html)

## Bring docker into play

Finally after applying those changes I was able to configure docker images - database and application became separate images. 
To communicate between app and db containers, I made use of the [docker container linking](https://docs.docker.com/engine/reference/run/).
One thing I'm not sure if I did right according to the docker philosophy was compiling the application before sending the compiled binaries to the docker build context.
This way was easiest for me, as I needed to access a Postgres db schema upon compilation - that's what SQLProvider requires in order to compile correctly.    

[GitBook - Dockerizing on mono section](https://theimowski.gitbooks.io/suave-music-store/content/en/dockerizing_mono.html)

## Summary

I get really excited when I think about that I managed to make it work, specially since I was a total noob with *nix stuff and Docker too (well ok, I probably still remain one).
Go check out 3 new sections (10.2 - 10.4) of the Suave Music Tutorial [here](https://theimowski.gitbooks.io/suave-music-store) to read more details about the conversion.
Till next time!